<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OrangePlanet</title>
    <!-- Element Plus CSS -->
    <link rel="stylesheet" href="https://unpkg.com/element-plus/dist/index.css" />
    <link rel="stylesheet" href="style.css?v=3">
    <!-- Vue 3 -->
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <!-- Element Plus -->
    <script src="https://unpkg.com/element-plus"></script>
    <!-- Icons -->
    <script src="https://unpkg.com/@element-plus/icons-vue"></script>
</head>
<body>
    <div id="app">
        <!-- Login View -->
        <div v-if="!isLoggedIn" class="login-container">
            <el-card class="login-card">
                <template #header>
                    <div class="login-header">
                        <h2>OrangePlanet</h2>
                        <p>浙大课表助手</p>
                    </div>
                </template>
                <el-form :model="loginForm" label-position="top" size="large">
                    <el-form-item label="学号">
                        <el-input v-model="loginForm.username" placeholder="请输入学号" :prefix-icon="User"></el-input>
                    </el-form-item>
                    <el-form-item label="密码">
                        <el-input v-model="loginForm.password" type="password" placeholder="请输入密码" show-password :prefix-icon="Lock"></el-input>
                    </el-form-item>
                    <el-form-item>
                        <el-button type="primary" @click="handleLogin" :loading="loading" style="width: 100%;">登录</el-button>
                    </el-form-item>
                </el-form>
            </el-card>
        </div>

        <!-- Main App View -->
        <el-container v-else style="height: 100vh;">
            <!-- Sidebar -->
            <el-aside width="64px" class="app-sidebar">
                <el-menu
                    default-active="1"
                    background-color="#fff"
                    text-color="#606266"
                    active-text-color="#409EFF"
                    collapse
                    class="el-menu-vertical"
                >
                    <div class="logo-container">
                        <el-icon :size="24" color="#409EFF"><ElementPlus /></el-icon>
                    </div>
                    <el-menu-item index="1">
                        <el-icon><Calendar /></el-icon>
                        <template #title>课表</template>
                    </el-menu-item>
                    <el-menu-item index="2">
                        <el-icon><Notebook /></el-icon>
                        <template #title>课程</template>
                    </el-menu-item>
                    <el-menu-item index="3">
                        <el-icon><Setting /></el-icon>
                        <template #title>设置</template>
                    </el-menu-item>
                </el-menu>
            </el-aside>

            <el-container>
                <el-header class="app-header">
                    <div class="header-left">
                        <h2>我的课表</h2>
                        <span class="subtitle">2024-2025秋冬学期</span>
                    </div>
                    <div class="header-right">
                        <el-button type="danger" plain size="small" @click="logout">退出登录</el-button>
                    </div>
                </el-header>
                
                <el-main style="padding: 0; overflow: hidden; display: flex; background-color: #f5f7fa;">
                    <div class="timetable-wrapper" style="flex: 1; overflow: auto; display: flex; padding: 20px;">
                        <!-- Time Column -->
                        <div class="time-column">
                            <div class="time-slot-header"></div>
                            <div class="time-slot" v-for="slot in timeSlots" :key="slot.id">
                                <span>{{ slot.id }}</span>
                                <span class="time-text">{{ slot.time }}</span>
                            </div>
                        </div>

                        <!-- Grid -->
                        <div class="days-grid" id="timetable-grid">
                            <!-- Headers -->
                            <div class="day-header" v-for="day in days" :key="day">{{ day }}</div>
                            
                            <!-- Grid Cells (Background) -->
                            <template v-for="row in 13">
                                <div class="grid-cell" v-for="col in 7" :key="`cell-${row}-${col}`" 
                                     :style="{ gridRow: row + 1, gridColumn: col }">
                                </div>
                            </template>

                            <!-- Course Cards -->
                            <div v-for="(course, index) in processedCourses" :key="index"
                                 class="course-card"
                                 :style="getCourseStyle(course)"
                                 @click="showDetails(course)">
                                <div class="course-name">{{ course.name }}</div>
                                <div class="course-location">{{ course.location }}</div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Details Panel -->
                    <transition name="slide-fade">
                        <div class="details-panel" v-if="currentCourse">
                            <div class="panel-header">
                                <h3>课程详情</h3>
                                <el-button link @click="currentCourse = null"><el-icon><Close /></el-icon></el-button>
                            </div>
                            <el-descriptions :column="1" border size="large">
                                <el-descriptions-item label="课程名称">{{ currentCourse.name }}</el-descriptions-item>
                                <el-descriptions-item label="教师">{{ currentCourse.teacher }}</el-descriptions-item>
                                <el-descriptions-item label="地点">{{ currentCourse.location }}</el-descriptions-item>
                                <el-descriptions-item label="时间">{{ currentCourse.dayOfWeek }} 第{{ currentCourse.startTime }}节</el-descriptions-item>
                                <el-descriptions-item label="周次">{{ currentCourse.weeks }}</el-descriptions-item>
                                <el-descriptions-item label="学分">{{ currentCourse.credits }}</el-descriptions-item>
                            </el-descriptions>
                        </div>
                    </transition>
                </el-main>
            </el-container>
        </el-container>
    </div>
    <script src="renderer.js?v=4"></script>
</body>
</html>
